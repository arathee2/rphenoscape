---
title: "Mutually Exclusive Phenotypes"
author: "Amandeep Rathee"
date: "1/9/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


The goal is to establish mutual exclusion in phenotypes. This vignette provides a pseudo code of a function that takes any two phenotypes and outputs whether they are mutually exclusive based on the phenoscape knowledgebase.

```{r include=TRUE, echo=TRUE, warning=FALSE, render=FALSE}

are_mutually_exclusive <- function(phenotype.a, phenotype.b){
  
  # mutually_exclusive takes three values:
      # -1: default; we assume that before checking mutual exclusion, phenotypes are neither mutually exclusive nor mutually compatible
      #  0: data suggests mutual compatibility
      #  1: data suggests mutual exclusion
  mutually_exclusive <- -1
  
  # for each phenotype, store all the characters in one array, and all character_state sequences in another array
  studies.a <- get_studies(taxon, phenotype.a)
  char_states.a <- vector()    # all chracter_state sequences of A
  chars.a <- vector()          # all characters of A
    
  for(study in studies.a){
      char.a <- get_char(get_entity(phenotype.a))
      state.a <- get_state(char.a)
      
      chars.a <- c(chars.a, char.a)
      char_states.a <- c(char_states.a, paste(char.a, state.a, sep="_"))
  }
  
  studies.b <- get_studies(taxon, phenotype.b)
  char_states.b <- vector()    # all chracter_state sequences of B
  chars.b <- vector()          # all characters of B
    
  for(study in studies.b){
      char.b <- get_char(get_entity(phenotype.b))
      state.b <- get_state(char.b)
      
      chars.b <- c(chars.b, char.b)
      char_states.b <- c(char_states.b, paste(char.b, state.b, sep="_"))
  }
  
  
  # determine if any two characters match
  char_match <- FALSE
  for (a in chars.a){
    for (b in chars.b){
      if(a == b){
        char_match <- TRUE
      }
    }
  }
    

  if(char_match == FALSE){
    # CASE 1: if no characters match --> mutually compatible
    mutually_exclusive <- 0
    print("Phenotypes are mutually compatible.")
  
  # CASE 2: if characters match, look whether ALL states are different (mutually exclusive), or if any two states are same (mutually comptabile)
  } else {
    
    
      # CASE 2A: check whether ALL states are different wherever characters are same; if this is true --> mutually exclusive
      
      # for mutual exclusion, ALL wherever there's a character match, we should have a different state
      char_match_count = 0
      state_different_count = 0
      
      for(char_state.a in char_states.a){
        for (char_state.b in char_states.b){
          char.a <- get_char(char_state.a)    # use regex to get character from character_state value
          state.a <- get_state(char_state.a)  # use regex to get state from character_state value
          
          char.b <- get_char(char_state.b)
          state.b <- get_state(char_state.b)
          
          if(char.a == char.b){
            char_match_count = char_match_count + 1
            if(state.a != state.b){
              state_different_count = state_different_count + 1
            }
          }
        }
      }
      
      if(char_match_count == state_different_count){
        mutually_exclusive <- 1
        print("Phenotypes are mutually exclusive.")
      } else {
        # CASE 2B:check whether any two states match where characters are same --> mutually compatible
        for(a in char_state.a){
          for(b in char_state.b){
            if(a == b){
              mutually_exclusive <- 0
              print("Phenotypes are mutually compatible.")
            }
          }
        }
      }
  }
    
  return(mutually_exclusive)
}


```